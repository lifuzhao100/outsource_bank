{"version":3,"sources":["webpack:///./less/index.mobile.less?7849","webpack:///./stores/index_index.js","webpack:///./helpers/get_param.js","webpack:///./imgs/banner.png","webpack:///./imgs/head.png","webpack:///./helpers/fresh_token.js","webpack:///./pages_mobile/index/index.js","webpack:///./imgs/bottom.png","webpack:///./helpers/multiple_class.js"],"names":["module","exports","index","grid-section","img","map-container","container","_mobx","__webpack_require__","Store","observable","search","location","href","split","paramsObj","forEach","p","paramArr","length","key","value","concat","wxToken","notForce","code","requestURL","encodeURIComponent","Promise","resolve","reject","axios","get","params","then","res","catch","window","getWxToken","_get_param2","default","refreshWxToken","_react","_mobxReact","_fresh_token","Index","observer","getUserLocation","latLng","data","store","_this","loadScript","resData","error_code","errorCode","init","initMap","script","document","createElement","type","src","body","appendChild","latitude","longitude","mapContainer","getElementById","style","height","myLatlng","qq","maps","LatLng","myOptions","zoom","center","mapTypeId","MapTypeId","ROADMAP","map","Map","latLngBounds","LatLngBounds","searchService","SearchService","complete","results","pois","detail","i","l","poi","extend","marker","Marker","position","setTitle","markers","push","fitBounds","latlngBounds","setPageCapacity","searchNearBy","getIndexList","index_list","Component","list","Array","from","_react2","className","_multiple_class2","styles","_wingBlank2","banner","width","head","_grid2","columnNum","renderItem","dataItem","url","logo","id","this","styleObj","classStr","trim","join"],"mappings":"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","file":"scripts/17_1cbfacb49fa1a303e19b.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"index\":\"NBTPEOnHPEEn5tPSF1w_c\",\"grid-section\":\"_2HIMQYkQoRe0NzHL-mjblU\",\"img\":\"_7B8iEwl_segTVQfEhQLSk\",\"map-container\":\"_2L8er1C0yOPM8g0-BTddMK\",\"container\":\"_3iqK_pGAevt3KY9CayYakZ\"};","import { observable } from 'mobx';\r\nclass Store {\r\n\t@observable index_list = [];\r\n}\r\nexport default new Store();","let getParam = () => {\r\n\tlet search = location.href.split('?')[1];\r\n\tsearch = search.split('#')[0];//去除hash的干扰\r\n\tif(search){\r\n\t\tlet paramsArr = search.split('&');\r\n\t\tlet paramsObj = {};\r\n\t\tparamsArr.forEach(p => {\r\n\t\t\tlet paramArr = p.split('=');\r\n\t\t\tif(paramArr.length === 2){\r\n\t\t\t\tlet key = paramArr[0];\r\n\t\t\t\tlet value = paramArr[1];\r\n\t\t\t\tif(paramsObj[key]){\r\n\t\t\t\t\tparamsObj[key] = [value].concat(paramsObj[key]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tparamsObj[key] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn paramsObj;\r\n\t}\r\n\treturn {};\r\n};\r\nexport default getParam;","module.exports = __webpack_public_path__ + \"imgs/banner5bb9a1d8a76d20e4bc38f38499b875c4.png\";","module.exports = __webpack_public_path__ + \"imgs/head5665e6c983402ad1611fa7033de8ac95.png\";","import axios from 'axios';\r\nimport getParam from './get_param';\r\nlet wxToken = (notForce, code) => {\r\n\tlet origin = encodeURIComponent(location.href.split('#')[0]);\r\n\tlet appid = 'wxf4b7d664b2461f4b';\r\n\tlet requestURL = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${appid}&redirect_uri=${origin}&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect;`\r\n\t//notForce true,上传code供后端获取用户信息 false,强制重新获取code\r\n\tif(!notForce){\r\n\t\twindow.location = requestURL;\r\n\t}else{\r\n\t\treturn new Promise((resolve, reject) =>{\r\n\t\t\taxios.get('/api/v1/token/user', {\r\n\t\t\t\tparams: {\r\n\t\t\t\t\tcode\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t\t.then(res => {\r\n\t\t\t\t\tresolve(res);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(res => {\r\n\t\t\t\t\treject(res);\r\n\t\t\t\t})\r\n\t\t})\r\n\t}\r\n};\r\n\r\nlet getWxToken = () => {\r\n\t//如果有code则上传\r\n\tlet code = getParam().code;\r\n\twxToken(!!code, code);\r\n};\r\nlet refreshWxToken = () => {\r\n\t//强制重新获取code\r\n\twxToken(false);\r\n};\r\nexport {\r\n\tgetWxToken,\r\n\trefreshWxToken\r\n};","import React, { Component } from 'react';\r\nimport { WingBlank, Grid } from 'antd-mobile';\r\nimport banner from '../../imgs/banner.png';\r\nimport head from '../../imgs/head.png';\r\nimport bottom from '../../imgs/bottom.png';\r\nimport styles from '../../less/index.mobile.less';\r\nimport multipleClass from '../../helpers/multiple_class';\r\nimport { observer } from 'mobx-react';\r\nimport store from '../../stores/index_index';\r\nimport axios from 'axios';\r\nimport { getWxToken } from '../../helpers/fresh_token';\r\nlet getUserLocation = () => {\r\n\taxios.get('/api/v1/location')\r\n\t\t.then(res => {\r\n\t\t\tlet {appId, timestamp, nonceStr, signature} = res.data;\r\n\t\t\twx.config({\r\n\t\t\t\tdebug: true,\r\n\t\t\t\tappId,\r\n\t\t\t\ttimestamp,\r\n\t\t\t\tnonceStr,\r\n\t\t\t\tsignature,\r\n\t\t\t\tjsApiList: ['getLocation']\r\n\t\t\t});\r\n\t\t});\r\n};\r\n\r\n@observer\r\nclass Index extends Component{\r\n\trender(){\r\n\t\tlet list = Array.from(store.index_list);\r\n\t\treturn (\r\n\t\t\t<div className={multipleClass(styles, 'index')}>\r\n\t\t\t\t<WingBlank>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<img src={banner} style={{width: '100%'}}/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<section className={multipleClass(styles, 'grid-section')}>\r\n\t\t\t\t\t\t<h3>\r\n\t\t\t\t\t\t\t<img src={head} style={{width: '100%'}}/>\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<Grid\r\n\t\t\t\t\t\t\tcolumnNum={3}\r\n\t\t\t\t\t\t\tdata={list}\r\n\t\t\t\t\t\t\trenderItem={dataItem => (\r\n\t\t\t\t\t\t\t\t<a href={dataItem.url}>\r\n\t\t\t\t\t\t\t\t\t<img src={dataItem.logo} style={{width: '100%'}}/>\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</section>\r\n\t\t\t\t\t<div className={multipleClass(styles,'map-container')}>\r\n\t\t\t\t\t\t<div id='container' className={multipleClass(styles, 'container')}></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</WingBlank>\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n\tcomponentDidMount(){\r\n\t\tthis.getIndexList();\r\n\t\tthis.getUserLocation();\r\n\t}\r\n\tgetUserLocation = () => {\r\n\t\taxios.get('/api/v1/location')\r\n\t\t\t.then(res => {\r\n\t\t\t\tlet latLng = res.data[0] || {};\r\n\t\t\t\tstore.latLng = latLng;\r\n\t\t\t\tthis.loadScript();\r\n\t\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tlet resData = res.data;\r\n\t\t\t\tif(resData.error_code === 10001 || resData.errorCode === 10001){\r\n\t\t\t\t\tlet promise = getWxToken();\r\n\t\t\t\t\tpromise.then(res => {\r\n\t\t\t\t\t\tthis.getUserLocation();\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t};\r\n\tloadScript = () => {\r\n\t\twindow.init = this.initMap;\r\n\t\tlet script = document.createElement(\"script\");\r\n\t\tscript.type = \"text/javascript\";\r\n\t\tscript.src = \"http://map.qq.com/api/js?v=2.exp&callback=init\";\r\n\t\tdocument.body.appendChild(script);\r\n\t};\r\n\tinitMap = () => {\r\n\t\tlet { latLng } = store;\r\n\t\tlet { latitude, longitude } = latLng;\r\n\t\tlet mapContainer = document.getElementById('container');\r\n\t\tmapContainer.style.height = '220px';\r\n\t\tlet myLatlng = new qq.maps.LatLng(latitude, longitude);\r\n\t\tlet myOptions = {\r\n\t\t\tzoom: 13,\r\n\t\t\tcenter: myLatlng,\r\n\t\t\tmapTypeId: qq.maps.MapTypeId.ROADMAP\r\n\t\t};\r\n\t\tlet map = new qq.maps.Map(mapContainer, myOptions);\r\n\t\tlet markers ;\r\n\t\tvar latLngBounds = new qq.maps.LatLngBounds();\r\n\t\t//调用Poi检索类\r\n\t\tlet searchService = new qq.maps.SearchService({\r\n\t\t\tcomplete : function(results){\r\n\t\t\t\tlet pois = results.detail.pois;\r\n\t\t\t\tfor(let i = 0,l = pois.length;i < l; i++){\r\n\t\t\t\t\tlet poi = pois[i];\r\n\t\t\t\t\tlatLngBounds.extend(poi.latLng);\r\n\t\t\t\t\tlet marker = new qq.maps.Marker({\r\n\t\t\t\t\t\tmap:map,\r\n\t\t\t\t\t\tposition: poi.latLng\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tmarker.setTitle(i+1);\r\n\r\n\t\t\t\t\tmarkers.push(marker);\r\n\t\t\t\t}\r\n\t\t\t\tmap.fitBounds(latlngBounds);\r\n\t\t\t}\r\n\t\t});\r\n\t\tsearchService.setPageCapacity(5);\r\n\t\tsearchService.searchNearBy('银行', myLatlng, 200);\r\n\t};\r\n\tgetIndexList = () => {\r\n\t\taxios.get('/api/v1/wx/navs')\r\n\t\t\t.then(res => {\r\n\t\t\t\tlet resData = res.data;\r\n\t\t\t\tstore.index_list = resData;\r\n\t\t\t})\r\n\t\t\t.catch(res => {\r\n\t\t\t\tlet resData = res.data;\r\n\t\t\t\tif(resData.error_code === 10001 || resData.errorCode === 10001){\r\n\t\t\t\t\tlet promise = getWxToken();\r\n\t\t\t\t\tpromise.then(res => {\r\n\t\t\t\t\t\tthis.getIndexList();\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}\r\n}\r\nexport default Index;","module.exports = __webpack_public_path__ + \"imgs/bottomdeb552c1a1d2eed07d5b4817e8f6be20.png\";","let multipleClass = (styleObj, classStr) => {\r\n\treturn classStr.trim().split(/\\s+/).map(key => styleObj[key]).join(' ');\r\n};\r\nexport default multipleClass;"],"sourceRoot":""}